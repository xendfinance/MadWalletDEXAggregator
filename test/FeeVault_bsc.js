const { BN, ether, balance } = require('openzeppelin-test-helpers');
const { expect } = require('chai');

const FeeVault = artifacts.require("FeeVault");
const ForceSend = artifacts.require('ForceSend');

const usdtABI = require('./abi/usdt');
const usdtAddress = "0x55d398326f99059fF775485246999027B3197955";
const usdtContract = new web3.eth.Contract(usdtABI, usdtAddress);

const busdABI = require('./abi/busd');
const busdAddress = "0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56";
const busdContract = new web3.eth.Contract(busdABI, busdAddress);

contract('test FeeVault', async([alice, bob, admin, dev, minter]) => {
    before(async () => {
        this.feeVaultContract = await FeeVault.new("0x1a1ec25DC08e98e5E93F1104B5e5cdD298707d31", {from: alice});
        const forceSend = await ForceSend.new();
        await forceSend.go("0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15", { value: ether('1') });
    });

    it('fee test', async() => {
        // await this.feeVaultContract.setFee(100);
        await this.feeVaultContract.setFeeAddress("0x67926b0C4753c42b31289C035F8A656D800cD9e7");
        let usdtBalance = await usdtContract.methods.balanceOf("0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15").call();
        // let usdtBalance = await usdtContract.methods.balanceOf(alice).call();
        console.log('before usdt balance: ', usdtBalance.toString());
        let busdBalance = await busdContract.methods.balanceOf("0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15").call();
        // busdBalance = await busdContract.methods.balanceOf(alice).call();
        console.log('before busd balance: ', busdBalance.toString());

        await usdtContract.methods.approve("0x1a1ec25DC08e98e5E93F1104B5e5cdD298707d31", '10000000000000000000').send({
            from: "0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15"
        });

        const result = await this.feeVaultContract.swap(
            "pmmFeeDynamic",
            "0x55d398326f99059fF775485246999027B3197955",
            1,
            "0x00000000000000000000000055d398326f99059ff775485246999027b3197955000000000000000000000000e9e7cea3dedca5984780bafc599bd69add087d560000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000042d4532e57a29e8d0000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000009bb0a13f93445000000000000000000000000071c292269718bc1e38edf6023fb427d35924389e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000006dbc4fe79e2541b03fe4731b2579c0b7f46f099000000000000000000000000c590175e458b83680867afd273527ff58f74c02b000000000000000000000000f9994570c235215633f8a1201233426e7489c5c500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004581236a1899ed0c0000000000000000000000000000000000000000000000004563918244f40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000061c92c8501ffffffffffffffffffffffffffffffffffffff15debdba61c92c0d0000001c000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000024f47261b0000000000000000000000000e9e7cea3dedca5984780bafc599bd69add087d56000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024f47261b000000000000000000000000055d398326f99059ff775485246999027b31979550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000421b0f0276b3446649db36ac37416b16e33aa98fd527c9048ebed0e477fe44df33411f30a15e35be8850a57666a3aa04e4b7806a62352efb449e875fe784445c3c3a03000000000000000000000000000000000000000000000000000000000000",
            {
                from : "0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15"
            }
        );
        console.log(result.logs[0].args.result);

        // usdtBalance = await usdtContract.methods.balanceOf("0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15").call();
        // // usdtBalance = await usdtContract.methods.balanceOf(alice).call();
        // console.log('after usdt balance: ', usdtBalance.toString());
        // busdBalance = await busdContract.methods.balanceOf("0x0B25a50F0081c177554e919EeFf192Cfe9EfDe15").call();
        // // busdBalance = await busdContract.methods.balanceOf(alice).call();
        // console.log('after busd balance: ', busdBalance.toString());
        // console.log('result: ',result.logs[0]);
        // usdtBalance = await usdtContract.methods.balanceOf("0x67926b0C4753c42b31289C035F8A656D800cD9e7").call();
        // console.log('fee balance: ', usdtBalance.toString());
    })
})

paraswap
https://bscscan.com/tx/0xfd50e98cbb2ca6ca187b662f3f32c2b169e63470f3a0b17c4af5bf7e74767a7e
https://bscscan.com/tx/0xa56ba12faf0b21648812afedc43f670adf3a613e2d08d70b95e1e9ad977f3853
https://bscscan.com/tx/0x66de039e90c791b8de4d7b7b9a1adee8c444adf5653e6145ed0918092e915dae

https://bscscan.com/tx/0xba1d7d16104f30a258d5a3436d4e89a075ff8656a570a639175ce0f007af4f90
https://bscscan.com/tx/0xe48ef150e8953f0c37165dcd769db63a0d61605f55cf287647612a88eeeb38db

pmm
https://bscscan.com/tx/0x2d2cd15d2124236ce0cdbeeb1482123aaa77cb1a32306d3b9c6922756b983238
https://bscscan.com/tx/0x9227a553280bc5bc9aca0719f752670944d7e5109a493b3e15c7a32378351d6b
https://bscscan.com/tx/0x1cb72387a34eedbffabda06ce4ed90e62cc0711ab87b77a70d7d0f11773b75de

airswapLight
https://bscscan.com/tx/0xfcd75ed61b6a98925f58039e567582a1a4fc9dead284db4a7d431bad7cab556c
https://bscscan.com/tx/0x40faab08207dbc0f693c916e1cdf00e1c50fad12da262a425fa400446d145e71
https://bscscan.com/tx/0x8feb058fa562ecca3d81a3d78ebde2020e7c3cec1d4147cedb81ffac2bd11ab0

oneInchV4
https://bscscan.com/tx/0x505f380464dfbca7df3ec819d9aacfa959a333a4a77d18951356a167967e0a80


zeroEx
https://bscscan.com/tx/0xd6026e2a8c9c2bdf92621f5e2dd4fb8fa17a6c71b08078e731be3f01bc5c7151
